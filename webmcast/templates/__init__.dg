import '/os'
import '/jinja2'


env = jinja2.Environment!
env.autoescape = True
env.trim_blocks = True
env.lstrip_blocks = True


load = name cache: {} root: (next $ iter __path__) ->
    path = os.path.join root name
    tpl, mtime = cache.get name (None, 0)
    real_mtime = os.path.getmtime path
    real_mtime > mtime =>
        tpl = env.from_string $ with f = open path => f.read!
        cache !! name = tpl, real_mtime
    return tpl
